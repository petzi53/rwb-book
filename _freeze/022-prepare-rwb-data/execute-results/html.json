{
  "hash": "cef71fd9fb90e97a63fc30ffcb882edf",
  "result": {
    "engine": "knitr",
    "markdown": "# Prepare RWB data {#sec-chap022}\n\n\n\n\n\n::::: {#obj-chap022}\n:::: {.my-objectives}\n::: {.my-objectives-header}\nObjectives\n:::\n\n\n::: {.my-objectives-container}\n\nTo get operating datasets I need to clean and recode the RWB data. I will do this in three different batches:\n\n1. 2022-2025: @sec-022-rwb-new\n2. 2013-2021: @sec-022-rwb-old\n3. 2002-2012\n\n:::\n::::\n:::::\n\n\n## RWB data 2022-2025 {#sec-022-rwb-new}\n\nOne disadvantage of the many different data files is that they have slightly different structures and coding singularities. They have not only different columns and column names, but also some important value issues:\n\n- The values are without decimal position. For instance instead of 80.52 the value is 8052.\n- Trailing zeros are not displayed. Instead of 80.50 the value is 805, or 80 instead of 80.00.\n- To distinguish ties in the latest year another figure is added as a (silent) comma position. Instead of 80.524 and 80.527 we have 80524 and 80527.\n- Some entries have stored accents as non UTF-8 characters.\n\n:::::{.my-procedure}\n:::{.my-procedure-header}\n:::::: {#prp-020-prepare-rwb-data1}\n: Prepare RWB data 2022-2025\n::::::\n:::\n::::{.my-procedure-container}\n\nBecause of the sightly different data structures the following full procedure is not always applied. Sometimes a step is missing, sometimes an additional step is added.\n\n0. Load {**dplyr**} library without displaying warnings and the raw m49 data with it function\n1. Get dataset via parameter handover\n2. Clean column names: Convert all characters to lower letters and spaces to underscore.\n3. Shorten column names by deleting the \"_context\" part\n4. Join data with the recoded M49 dataset from @lst-021-prepare-m49\n5. Select English country names\n6. Rename column `year_n` to `year` and relocate it as first column of the dataset\n7. Call function `df_recoded()` to recode all six different scores:\n    - for values smaller than 100, smaller than 1000, bigger than 10000 (sequence is important!)\n    - create column with evaluation (situation) categories\n\n::::\n:::::\n\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-022-prepare-rwb-data-new}\n: Preparing the RWB datasets 2022-2025\n::::::\n:::\n::::{.my-r-code-container}\n\n::: {.cell}\n\n```{#lst-022-prepare-rwb-data-new .r .cell-code  lst-cap=\"Functions to prepare the RWB datasets 2022-2025\"}\nlibrary(dplyr, warn.conflicts = FALSE)\nm49 <- base::readRDS(paste0(here::here(), \"/data/chap012/m49.rds\"))\n\nrwb_new <- function(df) { \n    df |>\n        janitor::clean_names() |>\n        rename_with(function(x){gsub(\"_context\",\"\", x)}) |>\n        left_join(m49_recoded(m49), \"iso\") |>\n        select(-c(country_fr, country_es:country_fa)) |>\n        relocate(year = year_n) |>\n        df_recoded(score) |>\n        df_recoded(political) |>\n        df_recoded(economic) |>\n        df_recoded(legal) |>\n        df_recoded(social) |>\n        df_recoded(safety)\n}\n\n\ndf_recoded_new <- function(df, col_name) {\n    df |>\n        mutate(\n            \"{{col_name}}\" := if_else({{col_name}} < 100, {{col_name}} * 100, {{col_name}}),\n            \"{{col_name}}\" := if_else({{col_name}} < 1000, {{col_name}} * 10, {{col_name}}),\n            \"{{col_name}}\" := if_else({{col_name}} > 10000, round({{col_name}} / 10), {{col_name}}),\n            \"{{col_name}}\" := {{col_name}} / 100,\n            \"{{col_name}}_situation\" := case_when(\n                {{col_name}} >= 85 ~ \"1. Good\",\n                {{col_name}} >= 70 & {{col_name}} <= 84.99 ~ \"2. Rather Good\",\n                {{col_name}} >= 55 & {{col_name}} <= 69.99 ~ \"3. Problematic\",\n                {{col_name}} >= 40 & {{col_name}} <= 54.99 ~ \"4. Difficult\",\n                {{col_name}} <= 39.99 ~ \"5. Very Serious\"\n            )\n        ) |>\n        relocate(last_col(), .after = {{col_name}})\n}\n```\n:::\n\n\n::::\n:::::\n\n## RWB data 2013-2022 {#sec-022-rwb-old}\n\nThe rationale for the recoding is very similar than for the period 2022 onwards.\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-022-prepare-rwb-data-old}\n: Preparing the RWB datasets 2022-2025\n::::::\n:::\n::::{.my-r-code-container}\n\n::: {.cell}\n\n```{#lst-022-prepare-rwb-data-old .r .cell-code  lst-cap=\"Functions to prepare the RWB datasets 2013-2021\"}\nlibrary(dplyr, warn.conflicts = FALSE)\nm49 <- base::readRDS(paste0(here::here(), \"/data/chap012/m49.rds\"))\n\nrwb_old <- function(df) {\n    df |>\n        janitor::clean_names() |>\n        rename_with(function(x){gsub(\"_context\",\"\", x)}) |>\n        left_join(m49_recoded(m49), \"iso\") |>\n        select(-c(fr_country, es_country:fa_country)) |>\n        relocate(year = year_n) |>\n        df_recoded(score_n) |>\n        rename(country_en = en_country)\n}\n\ndf_recoded_old <- function(df, col_name) {\n    df |>\n        mutate(\n            \"{{col_name}}\" := if_else({{col_name}} < 100, {{col_name}} * 100, {{col_name}}),\n            \"{{col_name}}\" := if_else({{col_name}} < 1000, {{col_name}} * 10, {{col_name}}),\n            \"{{col_name}}\" := if_else({{col_name}} > 10000, round({{col_name}} / 10), {{col_name}}),\n            \"{{col_name}}\" := {{col_name}} / 100,\n            \"{{col_name}}_situation\" := case_when(\n                {{col_name}} >= 85 ~ \"1. Good\",\n                {{col_name}} >= 75 & {{col_name}} <= 84.99 ~ \"2. Rather Good\",\n                {{col_name}} >= 65 & {{col_name}} <= 74.99 ~ \"3. Problematic\",\n                {{col_name}} >= 45 & {{col_name}} <= 64.99 ~ \"4. Difficult\",\n                {{col_name}} <= 44.99 ~ \"5. Very Serious\"\n            )\n        ) |>\n        relocate(last_col(), .after = {{col_name}})\n}\n```\n:::\n\n\n::::\n:::::\n\n\n::: {.callout-important #imp-022-r-script}\nThe preparing code of the RWB datasets are collected copied into the \"prepare-rwb.R\" file.\n:::\n\n## Session Info {.unnumbered}\n\n::: my-r-code\n::: my-r-code-header\nSession Info\n:::\n\n::: my-r-code-container\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.5.1 (2025-06-13)\n#>  os       macOS Sequoia 15.6\n#>  system   aarch64, darwin20\n#>  ui       X11\n#>  language (EN)\n#>  collate  en_US.UTF-8\n#>  ctype    en_US.UTF-8\n#>  tz       Europe/Vienna\n#>  date     2025-08-14\n#>  pandoc   3.7.0.2 @ /opt/homebrew/bin/ (via rmarkdown)\n#>  quarto   1.8.4 @ /usr/local/bin/quarto\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────\n#>  package     * version    date (UTC) lib source\n#>  cli           3.6.5      2025-04-23 [1] CRAN (R 4.5.0)\n#>  curl          6.4.0      2025-06-22 [1] CRAN (R 4.5.0)\n#>  digest        0.6.37     2024-08-19 [1] CRAN (R 4.5.0)\n#>  evaluate      1.0.4      2025-06-18 [1] CRAN (R 4.5.0)\n#>  fastmap       1.2.0      2024-05-15 [1] CRAN (R 4.5.0)\n#>  glossary    * 1.0.0.9003 2025-06-08 [1] local\n#>  htmltools     0.5.8.1    2024-04-04 [1] CRAN (R 4.5.0)\n#>  htmlwidgets   1.6.4      2023-12-06 [1] CRAN (R 4.5.0)\n#>  jsonlite      2.0.0      2025-03-27 [1] CRAN (R 4.5.0)\n#>  knitr         1.50       2025-03-16 [1] CRAN (R 4.5.0)\n#>  rlang         1.1.6      2025-04-11 [1] CRAN (R 4.5.0)\n#>  rmarkdown     2.29       2024-11-04 [1] CRAN (R 4.5.0)\n#>  rstudioapi    0.17.1     2024-10-22 [1] CRAN (R 4.5.0)\n#>  rversions     2.1.2      2022-08-31 [1] CRAN (R 4.5.0)\n#>  sessioninfo   1.2.3      2025-02-05 [1] CRAN (R 4.5.0)\n#>  xfun          0.52       2025-04-02 [1] CRAN (R 4.5.0)\n#>  xml2          1.3.8      2025-03-14 [1] CRAN (R 4.5.0)\n#>  yaml          2.3.10     2024-07-26 [1] CRAN (R 4.5.0)\n#> \n#>  [1] /Library/Frameworks/R.framework/Versions/4.5-arm64/library\n#>  [2] /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library\n#>  * ── Packages attached to the search path.\n#> \n#> ──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n:::\n:::\n\n",
    "supporting": [
      "022-prepare-rwb-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}