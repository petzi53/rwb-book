# RWB 2022-2025 {#sec-chap031}

::::: {#obj-chap031}
:::: {.my-objectives}
::: {.my-objectives-header}
Objectives
:::

::: {.my-objectives-container}

Generate the `rwb-new` dataset to work on.


:::
::::
:::::

I will start with the generation of the dataset for 2022-2025. `rwb-new` should work as my model for the displaying my first RWB world map.

To get a full dataset for 2022 I will need to work on the 2021 data as well, because I have to compare for each year the score/rank differences with the previous year.

Here now I have to pay attention the small differences between the various datasets. Therefore I have to work on each year separetely.

:::::{.my-r-code}
:::{.my-r-code-header}
:::::: {#cnj-031-generate-rwb-new}
: Generate RWB dataset for 2022-2025
::::::
:::
::::{.my-r-code-container}

<center>**Run this code chunk manually if the file(s) still needs to be downloaded.**</center>

```{r}
#| label: generate-rwb-new
#| lst-label: lst-031-generate-rwb-new
#| lst-cap: Generate RWB dataset for 2022-2025
#| eval: false


base::source(file = "R/helper.R")
base::source(file = "R/prepare-rwb.R")

library(dplyr, warn.conflicts = FALSE)

m49_clean <- base::readRDS(paste0(here::here(), "/data/chap021/m49_clean.rds"))
rsf2021 <- readRDS(paste0(here::here(), "/data/chap011/rsf2021.rds"))
rsf2022 <- readRDS(paste0(here::here(), "/data/chap011/rsf2022.rds"))
rsf2023 <- readRDS(paste0(here::here(), "/data/chap011/rsf2023.rds"))
rsf2024 <- readRDS(paste0(here::here(), "/data/chap011/rsf2024.rds"))
rsf2025 <- readRDS(paste0(here::here(), "/data/chap011/rsf2025.rds"))

rwb2021 <- rwb_old(rsf2021)

rwb2021_short <- rwb2021 |>
    select(c(iso, score_n, score_n_situation)) |>
    rename(
        score_n_1 = score_n,
        score_n_1_situation = score_n_situation
        )

rwb2022 <- rwb_new(rsf2022) |>
    left_join(rwb2021_short, "iso") |>
    mutate(
        score_evolution = score - score_n_1
    ) |>
    relocate(score_n_1:score_evolution, .after = rank_evolution)

rwb2023 <- rwb_new(rsf2023) |>
    df_recoded_new(score_n_1) |>
    mutate(score_evolution =
               as.double(stringr::str_replace(score_evolution, ",", "."))
    )


rwb2024 <- rwb_new(rsf2024) |>
    select(-situation) |>
    df_recoded_new(score_n_1) |>
    mutate(score_evolution =
               as.double(stringr::str_replace(score_evolution, ",", "."))
    )

rwb2025 <- rsf2025 |>
    rename(Score = `Score 2025`) |>
    rwb_new() |>
    mutate(
        country_en = case_when(
        stringr::str_detect(country_en, "d'Ivoire") ~ "Côte d'Ivoire",
        stringr::str_detect(country_en, "rkiye") ~ "Türkiye",
        .default = country_en
    ),
        zone = if_else(stringr::str_detect(zone, "riques"),
                "Amériques", zone)
    ) |>
    mutate(score_evolution =
               as.double(stringr::str_replace(score_evolution, ",", "."))
    ) |>
    df_recoded_new(score_n_1)



rwb_2022_2025 <- bind_rows(
    rwb2022, rwb2023, rwb2024, rwb2025
    ) |>
    mutate(
        zone = case_match(
            zone,
            "Afrique" ~ "Africa",
            "Amériques" ~ "Americas",
            "Asie-Pacifique" ~ "Asia-Pacific",
            "EEAC" ~ "Eastern Europe - Central Asia",
            "Europe - Asie centrale" ~ "Europe - Central Asia",
            "Maghreb - Moyen-Orient" ~ "Maghreb - Middle East",
            "MENA" ~ "Middle East - Northern Africa",
            "UE Balkans" ~ "EU Balkans",
            .default = NA
        )
    ) |>
    mutate(across(where(is.character), as.factor)) |>
    arrange(desc(year), desc(score))

my_save_data_file("chap031", rwb_2022_2025, "rwb_2022_2025.rds")


```

***

<center>(*For this R code chunk is no output available*)</center>

::::
:::::



## Glossary Entries {.unnumbered}

```{r}
#| label: glossary-table
#| echo: false

glossary_table()
```

------------------------------------------------------------------------

## Session Info {.unnumbered}

::: my-r-code
::: my-r-code-header
Session Info
:::

::: my-r-code-container
```{r}
#| label: session-info

xfun::session_info()
```
:::
:::

